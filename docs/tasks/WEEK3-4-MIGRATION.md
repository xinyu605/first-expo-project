# Week 3-4: 導入現有專案：策略與步驟

## A. 盤點與決策

### 原生相依分析
- [ ] **列出所有原生相依**
  - 相機功能與權限
  - 推播通知設定
  - 後台任務處理
  - 藍牙連線功能
  - 支付系統整合
  - 其他第三方原生模組

- [ ] **替代方案評估**
  - 確認是否有 Expo 模組可替代
  - 評估社群模組 + Config Plugin 方案
  - 分析遷移成本與風險

- [ ] **標記保留區塊**
  - 標記「必須保留原生改動」的區塊
  - 確定需要 Bare + Prebuild 的功能
  - 制定漸進式遷移策略

## B. 最小可行導入（Pilot）

### 專案準備
- [ ] **安裝 Expo 套件**
  ```bash
  npx install-expo-modules@latest
  # 或手動安裝
  npm install expo
  ```

- [ ] **修改入口點**
  - 將入口改為 `registerRootComponent(App)`
  - 確保相容性與功能正常

### 配置設定
- [ ] **建立/整理 app.config.***
  - 把圖示、權限等搬進 `expo` 區塊
  - 設定應用程式基本資訊
  - 配置更新與建置設定

- [ ] **Prebuild 執行**
  - 使用 `npx expo prebuild` 產生 `ios/`、`android/`
  - 處理原生依賴衝突
  - 確保建置成功

### 功能遷移
- [ ] **選定 Pilot 功能**
  - 選擇一個相對獨立的功能模組
  - 例如：影像挑選 + 上傳
  - 確保功能完整性與穩定性

- [ ] **Config Plugin 實作**
  - 將必要的原生改動轉為 Config Plugin
  - 或採用現成的 plugin
  - 確保可重複建置

## C. 發佈與驗證

### 測試版建置
- [ ] **EAS Build 產出**
  - 使用 EAS Build 產出測試版
  - 確保功能正常運作
  - 處理建置過程中的問題

- [ ] **漸進釋出**
  - 使用 EAS Update 對「development」做漸進釋出
  - 監控更新狀態與使用者反饋
  - 調整釋出策略

### 監控與分析
- [ ] **崩潰監控**
  - 整合 Sentry 或 Crashlytics
  - 監控應用程式穩定性
  - 分析崩潰原因與趨勢

- [ ] **效能指標**
  - 監控 Play Console Vitals
  - 分析應用程式效能
  - 識別效能瓶頸

## D. 推廣到整個 App

### 模組替換
- [ ] **第三方套件遷移**
  - 把可替換的第三方原生套件換成 Expo 模組
  - 或採用具 plugin 的替代方案
  - 確保功能相容性

- [ ] **原生改動標準化**
  - 把仍需原生改動的部分，轉為穩定的 Config Plugin
  - 建立 Prebuild 規則
  - 確保可重複性與維護性

### 流程優化
- [ ] **建置流程**
  - 優化 EAS Build 配置
  - 實作自動化建置流程
  - 建立品質檢查機制

- [ ] **更新流程**
  - 建立 OTA 更新流程
  - 實作版本管理策略
  - 建立回滾機制

## 實作任務

### 1. 專案分析
- [ ] **建立相依清單**
  - 列出所有原生依賴
  - 評估替代方案
  - 制定遷移優先順序

- [ ] **風險評估**
  - 分析遷移風險
  - 制定應對策略
  - 建立回滾計畫

### 2. Pilot 實作
- [ ] **選擇 Pilot 功能**
  - 選擇影像處理功能
  - 實作 Expo 模組整合
  - 測試功能完整性

- [ ] **Config Plugin 開發**
  - 實作必要的 Config Plugin
  - 測試 Plugin 功能
  - 確保可重複建置

### 3. 測試與驗證
- [ ] **建置測試**
  - 使用 EAS Build 建置測試版
  - 測試所有功能
  - 處理發現的問題

- [ ] **更新測試**
  - 實作 OTA 更新
  - 測試更新流程
  - 驗證回滾機制

## 驗收清單

### 分析能力
- [ ] 能完整列出專案的所有原生相依
- [ ] 能評估替代方案的可行性
- [ ] 能制定合理的遷移策略
- [ ] 能識別潛在的風險與挑戰

### 實作能力
- [ ] 能成功將現有專案導入 Expo
- [ ] 能實作 Config Plugin
- [ ] 能使用 EAS Build 產出測試版
- [ ] 能實作 OTA 更新機制

### 監控能力
- [ ] 能整合崩潰監控系統
- [ ] 能分析效能指標
- [ ] 能處理使用者反饋
- [ ] 能優化應用程式品質

## 常見問題與解決方案

### 遷移問題
- **原生依賴衝突**：使用 Config Plugin 解決
- **功能不相容**：尋找替代方案或自訂實作
- **建置失敗**：檢查配置與依賴版本

### 效能問題
- **應用程式變慢**：分析效能瓶頸並優化
- **記憶體使用增加**：檢查記憶體洩漏
- **啟動時間延長**：優化初始化流程

### 穩定性問題
- **崩潰率增加**：分析崩潰原因並修復
- **功能異常**：測試並修復問題
- **更新失敗**：檢查更新配置與流程

## 下一步
完成 Week 3-4 後，將進入 [Week 4-6: 上架與釋出流程](./WEEK4-6-RELEASE.md)，學習應用程式上架與正式發布流程。

## 參考資源
- [Expo 遷移指南](https://docs.expo.dev/bare/overview/)
- [Config Plugin 文件](https://docs.expo.dev/config-plugins/introduction/)
- [EAS Build 文件](https://docs.expo.dev/build/introduction/)
- [Sentry 整合指南](https://docs.sentry.io/platforms/react-native/)
